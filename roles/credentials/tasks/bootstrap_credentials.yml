---
- include_tasks: vault_password.yml

- include_tasks: encrypt_credentials.yml
  with_items: 
          # aws_credentials.yml
        - { name: 'access_key_id', value: '{{ access_key_id }}' }
        - { name: 'secret_access_key', value: '{{ secret_access_key }}' }

          # cluster.yml
        - { name: 'cluster_pod_openshift_pass', value: '{{ cluster_pod_openshift_pass }}' }
        - { name: 'rh_user', value: '{{ rh_user }}' }
        - { name: 'rh_pass', value: '{{ rh_pass }}' }
        - { name: 'htpasswd_password', value: '{{ htpasswd_password }}' }
  
          # integreatly.yml
        - { name: 'integreatly_vault', value: '{{ integreatly_vault }}' }

          # letsencrypt.yml
        - { name: 'letsencrypt_private_key', value: '{{ letsencrypt_private_key }}' }

          # tower_github_authentication.yml
        - { name: 'social_auth_github_org_key', value: '{{ social_auth_github_org_key }}' }
        - { name: 'social_auth_github_org_secret', value: '{{ social_auth_github_org_secret }}' }
        
          # tower_github_scm.yml
        - { name: 'tower_github_scm_password', value: '{{ tower_github_scm_password }}' }
        - { name: 'tower_github_scm', value: '{{ tower_github_scm }}' }

          # tower_openshift_authentication.yml
        - { name: "tower_openshift_username", value: '{{ tower_openshift_username }}' }
        - { name: "tower_openshift_password", value: '{{ tower_openshift_password }}' }

          # tower.yml
        - { name: 'tower_password', value: '{{ tower_password }}' }

          # tower_ssh.yml
        - { name: 'tower_ssh', value: '{{ tower_ssh }}' }
  no_log: true

- include_tasks: template_files.yml
  with_items: 
          # tower_openshift_authentication.yml
          - { src: "aws_credentials.yml.j2", dest: "aws_credentials.yml" }
          - { src: "cluster.yml.j2", dest: "cluster.yml" }
          - { src: "integreatly_vault.yml.j2", dest: "integreatly_vault.yml" }
          - { src: "letsencrypt.yml.j2", dest: "letsencrypt.yml" }
          - { src: "tower_github_authentication.yml.j2", dest: "tower_github_authentication.yml" }
          - { src: "tower_github_scm.yml.j2", dest: "tower_github_scm.yml" }
          - { src: "tower_openshift_authentication.yml.j2", dest: "tower_openshift_authentication.yml" }
          - { src: "tower.yml.j2", dest: "tower.yml" }
          - { src: "tower_ssh.yml.j2", dest: "tower_ssh.yml" }
           
- include_tasks: cleanup.yml
            
    

        
        